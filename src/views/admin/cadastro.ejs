<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/slim-select@2.6.0/dist/slimselect.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/slim-select@2.6.0/dist/slimselect.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <%- include('../includes/navbar') %>

  <div class="flex items-center justify-center flex-1 min-h-[calc(100vh-64px)]">
    <div class="bg-white shadow-lg rounded-lg p-6 w-full max-w-md mx-4 sm:mx-auto">
      <h1 class="text-2xl font-bold text-center mb-4">Cadastrar Usuário</h1>
      <form action="/cadastrar" method="POST" class="flex flex-col gap-3 mb-4">
        <% if (error) { %>
          <p class="text-red-500 text-center"><%= error %></p>
        <% } %>

        <input type="text" name="nome" placeholder="Nome" value="<%= formData?.nome || '' %>" required
          class="p-2 border rounded" />
        <input type="email" name="email" placeholder="Email" value="<%= formData?.email || '' %>" required
          class="p-2 border rounded" />
        <input type="password" name="senha" placeholder="Senha" value="<%= formData?.senha || '' %>" required
          class="p-2 border rounded" />

        <select name="instituto" id="instituto" class="p-2 border rounded" <%= userTipo === 'diretor' ? 'disabled' : '' %>>
          <option value="" disabled selected hidden>Selecione uma instituição</option>
          <% instituicoes.forEach(inst => { %>
            <option value="<%= inst.id %>" <%= formData?.instituto === inst.id ? 'selected' : '' %>><%= inst.nome %></option>
          <% }) %>
        </select>

        <select name="tipo" id="tipo" class="p-2 border rounded">
          <% 
            const tiposPermitidos = userTipo==='admin' ? ['aluno','professor','diretor','admin'] : ['aluno','professor','diretor'];
            tiposPermitidos.forEach(t => { 
          %>
            <option value="<%= t %>" <%= formData?.tipo === t ? 'selected' : '' %>><%= t.charAt(0).toUpperCase()+t.slice(1) %></option>
          <% }) %>
        </select>

        <select name="curso" id="curso" class="p-2 border rounded">
          <option value="" disabled selected hidden>Selecione um curso</option>
        </select>

        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">
          Cadastrar
        </button>
      </form>
    </div>
  </div>

  <div id="dados"
     data-cursos='<%= JSON.stringify(cursosPorInstituicao || {}) %>'
     data-usertipo="<%= userTipo %>"
     data-formcurso="<%= formData?.curso || '' %>">
</div>
  <div id="dados" data-cursos='<%= JSON.stringify(cursosPorInstituicao || {}) %>'></div>

<script src="/js/cadastro.js"></script>
</body>
</html>
